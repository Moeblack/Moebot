# 记忆系统

Bot Agent 的核心是其复杂且仿生的记忆系统，它模仿人类的遗忘和内省机制。

## 分层记忆架构

### 1. 工作记忆 (Working Memory)
- **定义**: 存储在内存和 `chat_history.jsonl` 中的最近对话记录。
- **作用**: 提供即时的上下文。
- **阈值**: 默认为 50 条。超过后触发“潮汐归档”。

### 2. 情节记忆 (Episodic Memory)
- **定义**: 对过去对话的摘要总结，以时间线形式存储。
- **作用**: 提供长期背景，减少 Token 消耗。
- **生成**: 通过 AI 对工作记忆进行压缩总结得到。

## 人格与进化

### 人格定义 (Persona)
每个人格包含：
- `base_personality`: 基础设定。
- `traits`: 性格特质列表。
- `impressions`: 对不同用户的特定印象。

### 进化逻辑 (Evolution)
- **特质演化**: 归档时，AI 会审视对话历史，更新或增加人格特质。
- **印象演化**: 记录用户在对话中表现出的特征，形成长期的交互策略。

## 潮汐归档 (Tidal Archiving)

这是一种自动化的记忆管理机制：
1.  **触发**: 当某个会话的未归档消息数达到设定值。
2.  **提取**: 提取最旧的一段消息。
3.  **总结**: AI 生成这些消息的情节摘要。
4.  **清理**: 将已总结的消息从工作记忆中移除。

## 存储方式

- **消息记录**: `data/chat_history.jsonl` (JSONL 格式方便追加)。
- **状态数据**: `data/memory_state.json` (记录计数器等)。
- **人格数据**: `data/personas/` (每个用户/群组独立文件)。
- **印象数据**: `data/impressions/` (针对具体用户的印象)。
